{% extends 'base.html.twig' %}
{% block title %}Cesta - Wembli{% endblock %}
{% block contenido %}
<h2 style="color:#1E3A8A; margin-bottom:15px;">Mi Cesta de Compra</h2>

{% if productos is not empty %}
    <table style="width:100%; border-collapse: collapse; text-align:left;">
        <thead>
            <tr style="background-color:#1E40AF; color:white;">
                <th style="padding:10px;">Producto</th>
                <th>Precio</th>
                <th>Unidades</th>
                <th>Subtotal</th>
                <th style="width: 200px;">Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% set total = 0 %}
            {% for key, producto in productos %}
                <tr style="border-bottom:1px solid #ccc;">
                    <td style="padding:8px;">{{ producto.nombre }}</td>
                    <td>{{ producto.precio|number_format(2, ',', '.') }} ‚Ç¨</td>
                    <td>{{ unidades[key] }}</td>
                    <td>{{ (producto.precio * unidades[key])|number_format(2, ',', '.') }} ‚Ç¨</td>
                    <td>
                        <form action="{{ path('eliminar', {'id': producto.id}) }}" method="POST" style="display: inline-flex; align-items: center; gap: 5px;">
                            <input type="number" 
                                   name="cantidad" 
                                   min="1" 
                                   max="{{ unidades[key] }}" 
                                   value="1" 
                                   style="width: 50px; padding: 4px; border: 1px solid #ccc; border-radius: 3px;">
                            <button type="submit" 
                                    style="padding: 5px 10px; background-color: #EF4444; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                Quitar
                            </button>
                            <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ producto.id) }}">
                        </form>
                        <form action="{{ path('eliminar', {'id': producto.id}) }}" method="POST" style="display: inline; margin-left: 5px;">
                            <input type="hidden" name="cantidad" value="{{ unidades[key] }}">
                            <button type="submit" 
                                    style="padding: 5px 10px; background-color: #991B1B; color: white; border: none; border-radius: 4px; cursor: pointer;"
                                    onclick="return confirm('¬øEliminar todos los {{ producto.nombre }}?');">
                                üóëÔ∏è Todo
                            </button>
                            <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ producto.id) }}">
                        </form>
                    </td>
                </tr>
                {% set total = total + (producto.precio * unidades[key]) %}
            {% endfor %}
        </tbody>
        <tfoot>
            <tr style="background-color:#f3f4f6; font-weight:bold;">
                <td colspan="3" style="padding:10px; text-align:right;">TOTAL:</td>
                <td colspan="2">{{ total|number_format(2, ',', '.') }} ‚Ç¨</td>
            </tr>
        </tfoot>
    </table>
    
    <div style="margin-top: 20px; text-align: right;">
        <a href="{{ path('categorias') }}" 
           style="padding: 10px 20px; background-color: #6B7280; color: white; text-decoration: none; border-radius: 5px; margin-right: 10px; display: inline-block;">
           Seguir Comprando
        </a>
        <a href="{{ path('pedido') }}" 
           style="padding: 10px 20px; background-color: #10B981; color: white; text-decoration: none; border-radius: 5px; display: inline-block;">
           üõí Realizar Pedido
        </a>
    </div>
{% else %}
    <p>Tu cesta est√° vac√≠a üõí</p>
    <a href="{{ path('categorias') }}" style="color:#1E40AF;">Ver categor√≠as</a>
{% endif %}
{% endblock %}